name: Deploy to Mini PC

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      # 1. This uses the Runner's built-in token to download code reliably
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Copy the fresh code to your app folder
      - name: Sync files to App Directory
        run: |
          # Copy all files from the runner to the app folder
          # We use cp -rT to copy contents without nesting
          cp -rf . /home/davis/app/

      # 3. Run the script (which we verified works!)
      - name: Execute Deployment
        run: |
          cd /home/davis/app
          bash deploy.sh