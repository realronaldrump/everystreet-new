{% extends "base.html" %} {% block title %}Every Street - Gas Tracking{%
endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', path='css/gas-tracking.css') | replace('http://', '//') }}"
/>
<link
  href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css"
  rel="stylesheet"
/>
{% endblock %} {% block content %}
<div class="container-fluid px-4 py-3">
  <div class="page-header mb-4">
    <h1 class="mb-2">Gas Tracking</h1>
    <p class="text-muted">
      Track fuel consumption, calculate MPG, and analyze driving costs
    </p>
  </div>

  <!-- Statistics Cards -->
  <div class="row g-3 mb-4" id="stats-container">
    <div class="col-12 col-md-6 col-xl-3">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-gas-pump"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">Total Fill-Ups</div>
          <div class="stat-value" id="stat-total-fillups">--</div>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">Total Spent</div>
          <div class="stat-value" id="stat-total-cost">--</div>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-tachometer-alt"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">Average MPG</div>
          <div class="stat-value" id="stat-avg-mpg">--</div>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6 col-xl-3">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">Current Gas Price</div>
          <div class="stat-value" id="stat-current-price">--</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Add Section -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="fas fa-plus-circle me-2"></i>Record Fill-Up
      </h5>
      <button class="btn btn-sm btn-outline-secondary" id="toggle-form-btn">
        <i class="fas fa-chevron-down"></i>
      </button>
    </div>
    <div class="card-body" id="fillup-form-container">
      <form id="fillup-form">
        <div class="row g-3">
          <!-- Vehicle Selection -->
          <div class="col-12 col-md-6">
            <label for="vehicle-select" class="form-label">
              <i class="fas fa-car me-1"></i>Vehicle
            </label>
            <select class="form-select" id="vehicle-select" required>
              <option value="">Loading vehicles...</option>
            </select>
          </div>

          <!-- Fill-Up Time -->
          <div class="col-12 col-md-6">
            <label for="fillup-time" class="form-label">
              <i class="fas fa-clock me-1"></i>Fill-Up Time
            </label>
            <input
              type="datetime-local"
              class="form-control"
              id="fillup-time"
              required
            />
          </div>

          <!-- Price Per Gallon -->
          <div class="col-12 col-md-4">
            <label for="price-per-gallon" class="form-label">
              <i class="fas fa-dollar-sign me-1"></i>Price Per Gallon
            </label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input
                type="number"
                class="form-control"
                id="price-per-gallon"
                step="0.001"
                min="0"
                placeholder="3.899"
                required
              />
            </div>
          </div>

          <!-- Gallons -->
          <div class="col-12 col-md-4">
            <label for="gallons" class="form-label">
              <i class="fas fa-fill-drip me-1"></i>Gallons
            </label>
            <input
              type="number"
              class="form-control"
              id="gallons"
              step="0.01"
              min="0"
              placeholder="12.50"
              required
            />
          </div>

          <!-- Odometer -->
          <div class="col-12 col-md-4">
            <label for="odometer" class="form-label">
              <i class="fas fa-tachometer-alt me-1"></i>Odometer
            </label>
            <input
              type="number"
              class="form-control"
              id="odometer"
              step="0.1"
              min="0"
              placeholder="45230.5"
              required
            />
            <small class="text-muted" id="odometer-hint">Latest: --</small>
          </div>

          <!-- Full Tank Checkbox -->
          <div class="col-12 col-md-6">
            <div class="form-check mt-4">
              <input
                class="form-check-input"
                type="checkbox"
                id="is-full-tank"
                checked
              />
              <label class="form-check-label" for="is-full-tank">
                Full tank fill-up
              </label>
            </div>
          </div>

          <!-- Location -->
          <div class="col-12">
            <label for="location-text" class="form-label">
              <i class="fas fa-map-marker-alt me-1"></i>Location
            </label>
            <input
              type="text"
              class="form-control"
              id="location-text"
              placeholder="Select fill-up time to detect location..."
              readonly
            />
            <small class="text-muted" id="location-status"></small>
          </div>

          <!-- Location Map -->
          <div class="col-12">
            <div
              id="fillup-map"
              style="
                height: 250px;
                border-radius: 8px;
                border: 1px solid var(--border-color);
              "
            ></div>
            <small class="text-muted">Vehicle location at selected time</small>
          </div>

          <!-- Calculated Total -->
          <div class="col-12">
            <div class="alert alert-info mb-0">
              <i class="fas fa-calculator me-2"></i>
              <strong>Total Cost:</strong>
              <span id="calculated-total">$0.00</span>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="col-12">
            <button
              type="submit"
              class="btn btn-primary w-100"
              id="submit-fillup-btn"
            >
              <i class="fas fa-save me-2"></i>Save Fill-Up
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Fill-Ups History -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0"><i class="fas fa-history me-2"></i>Fill-Up History</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table id="fillups-table" class="table table-striped table-hover w-100">
          <thead>
            <tr>
              <th>Date</th>
              <th>Location</th>
              <th>Gallons</th>
              <th>Price/Gal</th>
              <th>Total Cost</th>
              <th>Odometer</th>
              <th>MPG</th>
              <th>Distance</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Data populated by DataTables -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Mobile Fill-Up Cards -->
  <div class="mobile-fillups-container">
    <div id="mobile-fillups-list">
      <!-- Cards will be populated by JavaScript -->
    </div>
  </div>
</div>

<!-- Edit Fill-Up Modal -->
<div
  class="modal fade"
  id="edit-fillup-modal"
  tabindex="-1"
  aria-labelledby="edit-fillup-modal-label"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="edit-fillup-modal-label">
          <i class="fas fa-edit me-2"></i>Edit Fill-Up
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form id="edit-fillup-form">
          <input type="hidden" id="edit-fillup-id" />
          <!-- Similar form fields as add form -->
          <div class="mb-3">
            <label for="edit-price-per-gallon" class="form-label"
              >Price Per Gallon</label
            >
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input
                type="number"
                class="form-control"
                id="edit-price-per-gallon"
                step="0.001"
                required
              />
            </div>
          </div>
          <div class="mb-3">
            <label for="edit-gallons" class="form-label">Gallons</label>
            <input
              type="number"
              class="form-control"
              id="edit-gallons"
              step="0.01"
              required
            />
          </div>
          <div class="mb-3">
            <label for="edit-odometer" class="form-label">Odometer</label>
            <input
              type="number"
              class="form-control"
              id="edit-odometer"
              step="0.1"
              required
            />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button type="button" class="btn btn-primary" id="save-edit-fillup-btn">
          <i class="fas fa-save me-2"></i>Save Changes
        </button>
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block extra_js %}
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<script>
  window.MAPBOX_ACCESS_TOKEN = "{{ MAPBOX_ACCESS_TOKEN }}";
</script>
<script src="{{ url_for('static', path='js/gas-tracking.js') | replace('http://', '//') }}"></script>
{% endblock %}
