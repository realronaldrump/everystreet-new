{% extends "base.html" %}

{% block title %}

Your Driving Story
{% endblock %}


{% block extra_css %}

  <link rel="stylesheet"
        href="{{ url_for('static', path='css/insights.css') | replace('http://', '//') }}?v={{ repo_version.commit_count }}" />
  <link rel="stylesheet" href="{{ CDN.datatables_css }}" />
  <link rel="stylesheet" href="{{ CDN.datatables_bs5_css }}" />

{% endblock %}


{% block content %}

  <div id="insights-page" class="insights-container">
    <!-- Hero Section -->
    <section class="insights-hero" data-accent="lime">
      <div class="hero-content">
        <div class="hero-badge">
          <i class="fas fa-chart-line"></i>
          <span>Your driving story</span>
        </div>
        <h1 class="hero-title">
          Here's what your time
          <br />
          <span class="highlight">on the road</span> reveals
        </h1>
        <p class="hero-subtitle">
          Every trip tells a story. These insights help you understand your driving patterns, celebrate your progress, and discover interesting facts about your journeys.
        </p>
        <div class="hero-stat-card">
          <div class="hero-stat-value counter" id="hero-total-miles">
0
          </div>
          <div class="hero-stat-label">
miles driven so far
          </div>
        </div>
      </div>
    </section>

    <!-- Quick Stats Section -->
    <section class="insights-section" data-accent="mint">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-star section-icon"></i>
            At a glance
        </h2>
        <p class="section-subtitle">
Quick highlights from your driving data
        </p>
      </div>

      <div class="metrics-grid">
        <div class="metric-card" data-widget-id="trips">
          <div class="metric-accent mint">
          </div>
          <div class="metric-content">
            <div class="metric-icon">
              <i class="fas fa-route"></i>
            </div>
            <div class="metric-value counter" id="total-trips">
0
            </div>
            <button type="button"
                    class="metric-label insights-drilldown-trigger"
                    data-drilldown="trips">
trips taken
            </button>
            <div class="metric-context">
              <i class="fas fa-info-circle"></i>
              <span id="trips-context">That's a lot of adventures!</span>
            </div>
          </div>
        </div>

        <div class="metric-card" data-widget-id="distance">
          <div class="metric-accent coral">
          </div>
          <div class="metric-content">
            <div class="metric-icon">
              <i class="fas fa-road"></i>
            </div>
            <div class="metric-value">
              <span class="counter" id="total-distance">0</span>
              <span class="metric-unit">mi</span>
            </div>
            <button type="button"
                    class="metric-label insights-drilldown-trigger"
                    data-drilldown="distance">
total distance
            </button>
            <div class="metric-context">
              <i class="fas fa-map-marker-alt"></i>
              <span id="distance-context">Keep exploring!</span>
            </div>
          </div>
        </div>

        <div class="metric-card" data-widget-id="time">
          <div class="metric-accent sky">
          </div>
          <div class="metric-content">
            <div class="metric-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="metric-value" id="total-time">
0h 0m
            </div>
            <button type="button"
                    class="metric-label insights-drilldown-trigger"
                    data-drilldown="duration">
time driving
            </button>
            <div class="metric-context">
              <i class="fas fa-hourglass-half"></i>
              <span id="time-context">Time well spent</span>
            </div>
          </div>
        </div>

        <div class="metric-card" data-widget-id="fuel">
          <div class="metric-accent purple">
          </div>
          <div class="metric-content">
            <div class="metric-icon">
              <i class="fas fa-gas-pump"></i>
            </div>
            <div class="metric-value">
              <span class="counter" id="total-fuel">0</span>
              <span class="metric-unit">gal</span>
            </div>
            <button type="button"
                    class="metric-label insights-drilldown-trigger"
                    data-drilldown="fuel">
fuel used
            </button>
            <div class="metric-context">
              <i class="fas fa-leaf"></i>
              <span id="fuel-context">Efficient driving!</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Interesting Facts Section -->
    <section class="insights-section" data-accent="amber">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-lightbulb section-icon"></i>
            Did you know?
        </h2>
        <p class="section-subtitle">
Interesting facts about your driving style
        </p>
      </div>

      <div class="facts-grid">
        <div class="fact-card" data-accent="coral">
          <div class="fact-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="fact-content">
            <button type="button"
                    class="insights-drilldown-trigger insights-title-button"
                    data-drilldown="hard_braking">
Driving Events
            </button>
            <button type="button"
                    class="fact-value insights-drilldown-trigger"
                    data-drilldown="hard_braking">
              <span class="counter" id="hard-braking">0</span> hard braking moments
            </button>
            <p class="fact-hint">
                Smooth braking saves fuel and keeps everyone comfortable
            </p>
          </div>
        </div>

        <div class="fact-card" data-accent="amber">
          <div class="fact-icon">
            <i class="fas fa-tachometer-alt"></i>
          </div>
          <div class="fact-content">
            <button type="button"
                    class="insights-drilldown-trigger insights-title-button"
                    data-drilldown="top_speed">
Speed Insights
            </button>
            <button type="button"
                    class="fact-value insights-drilldown-trigger"
                    data-drilldown="top_speed">
                Top speed: <span class="counter" id="max-speed">0</span> mph
            </button>
            <button type="button"
                    class="fact-hint insights-drilldown-trigger"
                    data-drilldown="avg_speed">
                Average: <span class="counter" id="avg-speed">0</span> mph
            </button>
          </div>
        </div>

        <div class="fact-card" data-accent="sky">
          <div class="fact-icon">
            <i class="fas fa-pause-circle"></i>
          </div>
          <div class="fact-content">
            <button type="button"
                    class="insights-drilldown-trigger insights-title-button"
                    data-drilldown="idle_time">
Time at Rest
            </button>
            <button type="button"
                    class="fact-value insights-drilldown-trigger"
                    data-drilldown="idle_time"
                    id="idle-time">
0h 0m
            </button>
            <p class="fact-hint">
                Time spent idling during your trips
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Charts Section -->
    <section class="insights-section charts-section" data-accent="purple">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-wave-square section-icon"></i>
            How your driving changes over time
        </h2>
        <p class="section-subtitle">
See patterns in your trips, distance, and habits
        </p>
      </div>

      <div class="charts-grid">
        <div class="chart-card chart-large">
          <div class="chart-header">
            <h3 class="chart-title">
              <button type="button"
                      class="insights-drilldown-trigger insights-title-button"
                      data-drilldown="trips">
Your driving journey
              </button>
            </h3>
            <div class="chart-controls">
              <div class="toggle-group">
                <button class="toggle-btn active" data-view="daily">
Daily
                </button>
                <button class="toggle-btn" data-view="weekly">
Weekly
                </button>
                <button class="toggle-btn" data-view="monthly">
Monthly
                </button>
              </div>
            </div>
          </div>
          <div class="chart-body">
            <div class="chart-loading" id="trends-loading">
              <div class="chart-loading-spinner">
              </div>
            </div>
            <canvas id="trendsChart" style="display: none"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- Period Summary Table -->
    <section class="insights-section" data-accent="coral">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-table section-icon"></i>
            Weekly and monthly summaries
        </h2>
        <p class="section-subtitle">
See your trip totals, fuel usage, and efficiency by period
        </p>
      </div>

      <div class="locations-card">
        <div class="table-responsive">
          <table class="data-table friendly-table" id="analytics-table">
            <thead>
              <tr>
                <th>
Period
                </th>
                <th>
Trips
                </th>
                <th>
Distance
                </th>
                <th>
Duration
                </th>
                <th>
Fuel
                </th>
                <th>
Events
                </th>
                <th>
Efficiency
                </th>
              </tr>
            </thead>
            <tbody>
              <!-- Dynamic content -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Time Patterns Section -->
    <section class="insights-section" data-accent="sky">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-clock section-icon"></i>
            When you like to drive
        </h2>
        <p class="section-subtitle">
Discover your preferred driving times
        </p>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="toggle-group">
            <button class="toggle-btn active" data-time="hour">
By Hour
            </button>
            <button class="toggle-btn" data-time="day">
By Day
            </button>
          </div>
        </div>
        <div class="chart-body">
          <canvas id="timeDistChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Favorite Places Section -->
    <section class="insights-section" data-accent="mint">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-map-marker-alt section-icon"></i>
            Places you visit most
        </h2>
        <p class="section-subtitle">
These are your regular destinations
        </p>
      </div>

      <div class="locations-card">
        <div class="table-responsive">
          <table class="data-table friendly-table" id="destinations-table">
            <thead>
              <tr>
                <th>
Where you've been
                </th>
                <th>
How many times
                </th>
                <th>
Distance to get there
                </th>
                <th>
How long you stay
                </th>
                <th>
Last visit
                </th>
              </tr>
            </thead>
            <tbody>
              <!-- Dynamic content -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

  </div>
</div>
</div>



<!-- Floating Action Button -->
<div class="fab-container">
  <div class="fab-menu" id="fab-menu">
    <button class="fab mini-fab" title="Refresh Data" id="refresh-data">
      <i class="fas fa-sync"></i>
    </button>
    <button class="fab mini-fab" title="Download Report" id="download-report">
      <i class="fas fa-file-pdf"></i>
    </button>
    <button class="fab mini-fab" title="Share Insights" id="share-insights">
      <i class="fas fa-share-alt"></i>
    </button>
  </div>
  <button class="fab" id="fab-main">
    <i class="fas fa-plus"></i>
  </button>
</div>

<!-- Custom tooltip -->
<div class="custom-tooltip" id="custom-tooltip">
</div>

<!-- Trip Details Modal -->
<div class="modal fade"
     id="tripDetailsModal"
     tabindex="-1"
     aria-labelledby="tripDetailsModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="tripDetailsModalLabel">
Trips
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
          <table class="table table-striped" id="modal-trips-table">
            <thead>
              <tr>
                <th>
Start Time
                </th>
                <th>
End Time
                </th>
                <th>
Duration
                </th>
                <th>
Distance
                </th>
                <th>
Start Location
                </th>
                <th>
Destination
                </th>
                <th>
Max Speed
                </th>
                <th>
Insight
                </th>
                <th>
Actions
                </th>
              </tr>
            </thead>
            <tbody>
              <!-- Dynamic content -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
Close
        </button>
      </div>
    </div>
  </div>
</div>
</div>
{% endblock %}


{# Page scripts are loaded via route-loader + swup. #}
