{% extends "base.html" %}
{% block title %}Student Worker Hours & Payroll Analytics{% endblock %}

{% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', path='css/student-worker-analytics.css') | replace('http://', '//') }}"
/>
{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4 student-worker-analytics">
  <div class="row mb-4">
    <div class="col-12">
      <div class="analytics-hero shadow-sm">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-4">
          <div>
            <h1 class="display-5 fw-bold mb-2 d-flex align-items-center gap-3">
              <span class="badge bg-primary-subtle text-primary">
                <i class="fas fa-user-clock"></i>
              </span>
              Student Worker Hours &amp; Payroll
            </h1>
            <p class="lead text-secondary mb-0">
              Track logged hours, payroll totals, and staffing insights in one consolidated analytics view.
            </p>
          </div>
          <div class="text-lg-end">
            <div class="text-secondary text-uppercase fw-medium small mb-2">
              Data refreshed
            </div>
            <div id="last-refreshed" class="fs-5 fw-semibold text-primary">
              --
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mb-4">
    <div class="col-12 col-md-4">
      <div class="metric-card shadow-sm" id="total-hours-card" role="group" aria-label="Total hours worked">
        <div class="metric-label">Total Hours</div>
        <div class="metric-value" id="total-hours">0</div>
        <div class="metric-trend" id="hours-trend">
          <i class="fas fa-clock"></i>
          <span>--</span>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="metric-card shadow-sm" id="total-payroll-card" role="group" aria-label="Total payroll">
        <div class="metric-label">Total Payroll</div>
        <div class="metric-value" id="total-payroll">$0.00</div>
        <div class="metric-trend" id="payroll-trend">
          <i class="fas fa-chart-line"></i>
          <span>--</span>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="metric-card shadow-sm" id="avg-rate-card" role="group" aria-label="Average hourly rate">
        <div class="metric-label">Average Hourly Rate</div>
        <div class="metric-value" id="avg-rate">$0.00</div>
        <div class="metric-trend" id="worker-count">
          <i class="fas fa-users"></i>
          <span id="total-workers">0 workers</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card filters-card shadow-sm mb-4" role="region" aria-label="Student worker filters">
    <div class="card-body">
      <div class="row g-3 align-items-end">
        <div class="col-12 col-lg-4">
          <label for="search" class="form-label fw-semibold">Search</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input
              type="search"
              id="search"
              class="form-control"
              placeholder="Search by name, ID, or email"
              autocomplete="off"
            />
          </div>
        </div>
        <div class="col-6 col-lg-2">
          <label for="department-filter" class="form-label fw-semibold">Department</label>
          <select id="department-filter" class="form-select">
            <option value="">All</option>
          </select>
        </div>
        <div class="col-6 col-lg-2">
          <label for="status-filter" class="form-label fw-semibold">Status</label>
          <select id="status-filter" class="form-select">
            <option value="">All</option>
          </select>
        </div>
        <div class="col-6 col-lg-2">
          <label for="start-date-filter" class="form-label fw-semibold">Start Date</label>
          <input type="date" id="start-date-filter" class="form-control" />
        </div>
        <div class="col-6 col-lg-2">
          <label for="end-date-filter" class="form-label fw-semibold">End Date</label>
          <input type="date" id="end-date-filter" class="form-control" />
        </div>
        <div class="col-6 col-lg-2">
          <label for="page-size" class="form-label fw-semibold">Rows</label>
          <select id="page-size" class="form-select">
            <option value="10">10</option>
            <option value="25" selected>25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
        <div class="col-6 col-lg-2 text-lg-end ms-lg-auto">
          <button id="reset-filters" class="btn btn-outline-secondary w-100">
            <i class="fas fa-sync"></i>
            Reset
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0" id="student-workers-table">
          <thead class="table-light">
            <tr>
              <th scope="col" data-sort="name" class="sortable">Student</th>
              <th scope="col" data-sort="studentId" class="sortable">ID</th>
              <th scope="col" data-sort="department" class="sortable">Department</th>
              <th scope="col" data-sort="status" class="sortable">Status</th>
              <th scope="col" data-sort="hours" class="sortable text-end">Hours</th>
              <th scope="col" data-sort="rate" class="sortable text-end">Hourly Rate</th>
              <th scope="col" data-sort="pay" class="sortable text-end">Payroll</th>
              <th scope="col" data-sort="payPeriodEnd" class="sortable">Pay Period</th>
              <th scope="col" data-sort="updated" class="sortable">Last Updated</th>
            </tr>
          </thead>
          <tbody>
            <tr class="placeholder-row">
              <td colspan="9" class="text-center py-5 text-secondary">
                Loading student worker data...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mt-4">
    <div id="results-summary" class="text-secondary">
      Showing 0 of 0 workers
    </div>
    <nav aria-label="Student worker pagination">
      <ul class="pagination mb-0" id="pagination"></ul>
    </nav>
  </div>
</div>

<div class="loading-overlay" id="loading-overlay" aria-hidden="true">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', path='js/student_worker_analytics.js') | replace('http://', '//') }}" defer></script>
{% endblock %}
