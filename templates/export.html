{% extends "base.html" %}

{% block title %}

Every Street - Export Data
{% endblock %}


{% block extra_css %}

  <link rel="stylesheet"
        href="{{ url_for('static', path='css/export.css') | replace('http://', '//') }}" />
{% endblock %}


{% block content %}

  <div class="container-fluid export-page">
    <div class="bento-grid" data-stagger>
      <div class="bento-span-12 widget" data-accent="mint">
        <div class="widget-header">
          <div>
            <h1 class="widget-title">
              <i class="fas fa-file-export" aria-hidden="true"></i>
              Export Data
            </h1>
            <div class="widget-meta">
              Generate clean exports aligned to the current trips and coverage data model.
            </div>
          </div>
          <div class="export-hero-meta">
            <div class="text-secondary small">
Format
            </div>
            <div class="fw-semibold">
Zip bundle with manifest.json
            </div>
          </div>
        </div>
      </div>

      <div class="bento-span-8 widget" data-accent="purple">
        <div class="widget-header">
          <h2 class="widget-title">
            <i class="fas fa-sliders-h" aria-hidden="true"></i>
            Export Configuration
          </h2>
        </div>
        <div class="widget-body">
          <form id="export-form">
            <fieldset class="export-section">
              <legend class="h6">
Trip Data
              </legend>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="export-trips" checked />
                    <label class="form-check-label" for="export-trips">
Trips
                    </label>
                    <div class="form-text">
Raw GPS trips as stored in `trips`.
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="export-matched-trips" />
                    <label class="form-check-label" for="export-matched-trips">
                        Matched Trips
                    </label>
                    <div class="form-text">
Trips with map-matched geometry.
                    </div>
                  </div>
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="col-md-6">
                  <label class="form-label" for="trip-format">
Trip Export Format
                  </label>
                  <select class="form-select" id="trip-format">
                    <option value="json" selected>
JSON (full trip records)
                    </option>
                    <option value="csv">
CSV (tabular)
                    </option>
                    <option value="geojson">
GeoJSON (map-ready)
                    </option>
                    <option value="gpx">
GPX (track)
                    </option>
                  </select>
                </div>
                <div class="col-md-6">
                  <div class="form-check form-switch mt-4">
                    <input class="form-check-input" type="checkbox" id="include-trip-geometry" checked />
                    <label class="form-check-label" for="include-trip-geometry">
                        Include geometry in JSON/CSV
                    </label>
                    <div class="form-text">
Disabling keeps geometry fields as null.
                    </div>
                  </div>
                </div>
              </div>
            </fieldset>

            <fieldset class="export-section">
              <legend class="h6">
Trip Filters
              </legend>
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label" for="trip-start-date">
Start Date
                  </label>
                  <input type="date" class="form-control" id="trip-start-date" />
                </div>
                <div class="col-md-4">
                  <label class="form-label" for="trip-end-date">
End Date
                  </label>
                  <input type="date" class="form-control" id="trip-end-date" />
                </div>
                <div class="col-md-4 d-flex align-items-end">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="trip-all-time" />
                    <label class="form-check-label" for="trip-all-time">
All time
                    </label>
                  </div>
                </div>
              </div>

              <div class="row g-3 mt-1">
                <div class="col-md-4">
                  <label class="form-label" for="trip-status">
Trip Status
                  </label>
                  <select class="form-select" id="trip-status">
                    <option value="">
All statuses
                    </option>
                    <option value="processed">
Processed
                    </option>
                    <option value="completed">
Completed
                    </option>
                    <option value="active">
Active
                    </option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label" for="trip-vehicle">
Vehicle (IMEI)
                  </label>
                  <input class="form-control"
                         id="trip-vehicle"
                         list="vehicle-options"
                         placeholder="All vehicles" />
                  <datalist id="vehicle-options"></datalist>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="trip-include-invalid" />
                    <label class="form-check-label" for="trip-include-invalid">
Include invalid trips
                    </label>
                  </div>
                </div>
              </div>
            </fieldset>

            <fieldset class="export-section">
              <legend class="h6">
Coverage Data
              </legend>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="export-streets" />
                    <label class="form-check-label" for="export-streets">
Streets
                    </label>
                    <div class="form-text">
All street segments with status.
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="export-boundaries" />
                    <label class="form-check-label" for="export-boundaries">
Boundary
                    </label>
                    <div class="form-text">
Area polygon boundary.
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="export-undriven" />
                    <label class="form-check-label" for="export-undriven">
Undriven Streets
                    </label>
                    <div class="form-text">
Only undriven segments.
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label" for="coverage-area">
Coverage Area
                  </label>
                  <select class="form-select" id="coverage-area">
                    <option value="">
Select an area
                    </option>
                  </select>
                </div>
              </div>
              <div class="form-text mt-2">
Coverage exports are always GeoJSON.
              </div>
            </fieldset>

            <div class="export-actions">
              <div class="alert alert-danger d-none" role="alert" id="export-error">
              </div>
              <div class="d-flex flex-wrap gap-2">
                <button type="submit" class="btn btn-primary" id="export-submit">
                  <i class="fas fa-download me-2"></i>Create Export
                </button>
                <button type="button" class="btn btn-outline-secondary" id="export-reset">
                    Reset
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="bento-span-4 widget" data-accent="sky">
      <div class="widget-header">
        <h2 class="widget-title">
          <i class="fas fa-signal" aria-hidden="true"></i>
            Export Status
        </h2>
      </div>
      <div class="widget-body">
        <div id="export-summary" class="export-summary">
          <div class="export-summary-title">
Selected Items
          </div>
          <ul class="list-unstyled mb-0" id="export-summary-list">
            <li class="text-secondary">
No items selected yet.
            </li>
          </ul>
        </div>

        <div class="export-progress" id="export-progress">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-secondary" id="export-status-text">No export running</span>
            <span class="text-secondary" id="export-progress-percent">0%</span>
          </div>
          <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar" id="export-progress-bar" style="width: 0%">
            </div>
          </div>
        </div>

        <div class="export-result mt-4" id="export-result">
          <div class="export-summary-title">
Latest Export
          </div>
          <div class="text-secondary" id="export-result-details">
No export generated yet.
          </div>
          <a class="btn btn-success mt-3 d-none" id="export-download" href="#">
            <i class="fas fa-file-archive me-2"></i>Download Zip
          </a>
        </div>
      </div>
    </div>

    <div class="bento-span-4 widget" data-accent="amber">
      <div class="widget-header">
        <h3 class="widget-title">
          <i class="fas fa-circle-info" aria-hidden="true"></i>
            How exports work
        </h3>
      </div>
      <div class="widget-body">
        <p class="text-secondary small mb-2">
          Each export is generated from live data, packaged as a zip with a manifest and
          ready for spreadsheets or GIS tools.
        </p>
        <ul class="small text-secondary mb-0">
          <li>
Trips include map-matched data only when requested.
          </li>
          <li>
Coverage exports require a ready coverage area.
          </li>
          <li>
Manifests include schema version and record counts.
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}




{% block extra_js %}

  <script type="module"
          type="module"
          src="{{ url_for('static', path='js/modules/export/index.js') | replace('http://', '//') }}"></script>
{% endblock %}
