{% extends "base.html" %} {% block title %} Profile Settings {% endblock %} {%
block extra_css %}

<link
  rel="stylesheet"
  href="{{ url_for('static', path='css/settings.css') | replace('http://', '//') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', path='css/profile.css') | replace('http://', '//') }}"
/>

{% endblock %} {% block content %}

<div class="container-fluid settings-container">
  <h2 class="mb-4"><i class="fas fa-user-circle"></i> Profile Settings</h2>

  <!-- Credentials Status Banner -->
  <div
    id="credentials-status-banner"
    class="credentials-status"
    style="display: none"
  >
    <i class="fas fa-info-circle"></i>
    <span id="credentials-status-text"></span>
  </div>

  <!-- Bouncie API Credentials -->
  <div class="settings-group">
    <h3 class="settings-group-title">
      <i class="fas fa-key"></i>
      Bouncie API Credentials
    </h3>
    <p class="text-muted small">
      Configure your Bouncie API credentials for trip fetching. These
      credentials are stored securely in the database and will be used for all
      API requests.
    </p>

    <form id="bouncieCredentialsForm">
      <!-- Client ID -->
      <div class="mb-3">
        <label for="clientId" class="form-label">
          Client ID <span class="text-danger">*</span>
        </label>
        <input
          type="text"
          class="form-control credential-input"
          id="clientId"
          placeholder="Enter your Bouncie Client ID"
          required
        />
        <div class="form-text">
          Your Bouncie application's client identifier
        </div>
      </div>

      <!-- Client Secret -->
      <div class="mb-3">
        <label for="clientSecret" class="form-label">
          Client Secret <span class="text-danger">*</span>
        </label>
        <div class="input-group">
          <input
            type="password"
            class="form-control credential-input"
            id="clientSecret"
            placeholder="Enter your Bouncie Client Secret"
            required
          />
          <button
            class="btn btn-outline-secondary"
            type="button"
            id="toggleClientSecret"
          >
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <div class="form-text">
          Your Bouncie application's client secret (kept secure)
        </div>
      </div>

      <!-- Redirect URI -->
      <div class="mb-3">
        <label for="redirectUri" class="form-label">
          Redirect URI <span class="text-danger">*</span>
        </label>
        <input
          type="url"
          class="form-control credential-input"
          id="redirectUri"
          placeholder="https://your-domain.com/callback"
          required
        />
        <div class="form-text">
          The OAuth callback URL configured in your Bouncie application
        </div>
      </div>

      <!-- Authorization Code -->
      <div class="mb-3">
        <label for="authorizationCode" class="form-label">
          Authorization Code <span class="text-danger">*</span>
        </label>
        <div class="input-group">
          <input
            type="password"
            class="form-control credential-input"
            id="authorizationCode"
            placeholder="Enter your Bouncie Authorization Code"
            required
          />
          <button
            class="btn btn-outline-secondary"
            type="button"
            id="toggleAuthCode"
          >
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <div class="form-text">
          The authorization code obtained from Bouncie OAuth flow
        </div>
      </div>

      <!-- Authorized Devices -->
      <div class="mb-3">
        <label class="form-label">
          Authorized Devices (IMEIs) <span class="text-danger">*</span>
        </label>
        <div id="devicesList">
          <!-- Device inputs will be added here dynamically -->
        </div>
        <button
          type="button"
          class="btn btn-sm btn-outline-primary"
          id="addDeviceBtn"
        >
          <i class="fas fa-plus"></i> Add Device
        </button>
        <div class="form-text">
          IMEI numbers of devices authorized to fetch trip data from
        </div>
      </div>

      <!-- Fetch Concurrency -->
      <div class="mb-3">
        <label for="fetchConcurrency" class="form-label">
          Fetch Concurrency
        </label>
        <input
          type="number"
          class="form-control"
          id="fetchConcurrency"
          placeholder="12"
          min="1"
          max="50"
          value="12"
        />
        <div class="form-text">
          Maximum number of concurrent API requests when fetching trips (1-50,
          default: 12)
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="d-flex gap-2 flex-wrap">
        <button type="submit" class="btn btn-primary" id="saveCredentialsBtn">
          <i class="fas fa-save"></i> Save Credentials
        </button>
        <button type="button" class="btn btn-secondary" id="loadCredentialsBtn">
          <i class="fas fa-sync"></i> Reload
        </button>
        <button type="button" class="btn btn-info" id="unmaskCredentialsBtn">
          <i class="fas fa-eye"></i> Unmask All
        </button>
      </div>

      <div id="credentialsSaveStatus" class="mt-3" style="display: none"></div>
    </form>
  </div>

  <!-- Vehicle Management Link -->
  <div class="settings-group">
    <h3 class="settings-group-title">
      <i class="fas fa-car"></i>
      Vehicle Management
    </h3>
    <p class="text-muted small">
      Manage your vehicle details, odometer settings, and more.
    </p>
    <a href="/vehicles" class="btn btn-outline-primary">
      <i class="fas fa-car me-2"></i>Go to My Vehicle
    </a>
  </div>

  <!-- Help/Documentation -->
  <div class="settings-group">
    <h3 class="settings-group-title">
      <i class="fas fa-question-circle"></i>
      How to Get Your Credentials
    </h3>
    <ol>
      <li>
        <strong>Create a Bouncie Developer Account:</strong> Visit the
        <a href="https://developer.bouncie.com" target="_blank" rel="noopener">
          Bouncie Developer Portal
        </a>
        and sign up for an account.
      </li>
      <li>
        <strong>Create an Application:</strong> Once logged in, create a new
        application to get your Client ID and Client Secret.
      </li>
      <li>
        <strong>Configure Redirect URI:</strong> Set your redirect URI in the
        Bouncie application settings (e.g., https://your-domain.com/callback).
      </li>
      <li>
        <strong>Complete OAuth Flow:</strong> Use the OAuth 2.0 authorization
        flow to obtain an authorization code.
      </li>
      <li>
        <strong>Find Device IMEIs:</strong> Your device IMEI numbers can be
        found in your Bouncie account settings or on the physical device.
      </li>
    </ol>
    <p class="text-muted small mb-0">
      <i class="fas fa-info-circle"></i>
      <strong>Note:</strong> These credentials are stored securely in your
      database and are never exposed in logs or error messages.
    </p>
  </div>
</div>

{% endblock %} {% block extra_js %}

<script src="{{ url_for('static', path='js/profile.js') | replace('http://', '//') }}"></script>
{% endblock %}
